<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Explorer. Dream. Discover.">
    <title>Ubuntu12 虚拟机网络配置 - Explorer. Dream. Discover.</title>
    <meta name="author" content="Samuel Chen">
    <meta name="description" content="Explorer. Dream. Discover.">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="用VM Player 4.0装了Ubuntu 12 server，然后复制了几个组成局域网来使用，发现了一些问题，网上基本上找不到完整的解决方法，这里记录下来。">
<meta name="keywords" content="configuration,article,Linux,Ubuntu,VM,network">
<meta property="og:type" content="blog">
<meta property="og:title" content="Ubuntu12 虚拟机网络配置">
<meta property="og:url" content="http://blog.samuelchen.net/ubuntu12-vm-network-config/index.html">
<meta property="og:site_name" content="Explorer. Dream. Discover.">
<meta property="og:description" content="用VM Player 4.0装了Ubuntu 12 server，然后复制了几个组成局域网来使用，发现了一些问题，网上基本上找不到完整的解决方法，这里记录下来。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-04-16T16:18:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ubuntu12 虚拟机网络配置">
<meta name="twitter:description" content="用VM Player 4.0装了Ubuntu 12 server，然后复制了几个组成局域网来使用，发现了一些问题，网上基本上找不到完整的解决方法，这里记录下来。">
<meta name="twitter:creator" content="@samuelchen">
    
    
    
        <meta property="og:image" content="/assets/images/avatar.gif"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.css">
    <!--STYLES END-->
    
</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Explorer. Dream. Discover.</a>
    </h1>
    
        <a class="header-right-picture" href="/#about">
            <img class="header-picture" src="/assets/images/avatar.gif"/>
        </a>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    <div class="sidebar-profile">
        <a href="/#about">
            
            <img class="sidebar-profile-picture" src="/assets/images/avatar.gif"/>
            
        </a>
        <span class="sidebar-profile-name">Samuel Chen</span>
    </div>
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/ 
                    ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-categories
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-tags
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-archives
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link st-search-show-outputs"
                    href="#search
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="#about
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About me</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="http://www.samuelchen.net" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-user-secret"></i>
                    <span class="sidebar-button-desc">Website</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/samuelchen" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://stackoverflow.com/users/687197/samuel-chen" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://twitter.com/samuelchen" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/atom.xml
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://samuelchen.github.io/" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">Mirror on Github</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://samuelchen.github.io/legacy/" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Legacies</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">Ubuntu12 虚拟机网络配置</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Thu Jun 21 2012 19:09:05 GMT+0800">
        Jun 21, 2012
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/System/">System</a>


    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        
            <p>用VM Player 4.0装了Ubuntu 12 server，然后复制了几个组成局域网来使用，发现了一些问题，网上基本上找不到完整的解决方法，这里记录下来。</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在后来的实际应用中，了解了更多的方法，这种方法并不是一个比较好的方法，但仍不失为一个简单有效的方法。</span><br></pre></td></tr></table></figure>
<h2 id="Mac-地址"><a href="#Mac-地址" class="headerlink" title="Mac 地址"></a>Mac 地址</h2><p>复制的虚机Mac 地址都是相同的，组网会有问题，所以需要改过来。</p>
<p>首先是修改VM Setting，可以生成一个新的Mac地址，把它记录下来，假设是<br><code>00:AA:BB:CC:DD:EE</code> 。<br>网上的方法主要是</p>
<p><pre class="lang:default decode:true">sudo ifconfig eth0 down  #停掉网卡<br>sudo ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE   #改mac<br>sudo ifconfig eth0 up     #起网卡<br>sudo /etc/init.d/networking restart  #重启网络</pre><br>但是，这样是不成的（至少在这次），重启以后会失效，又变回原来的。网上给出的方案是在 <code>/etc/network/if-pre-up.d/</code> 中添加<br><code>ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE</code>，但我试过了是不行的。<br>另外有一种方法就是修改 <code>/etc/rc.local</code> 每次启动修改，但这种方法不太爽。<br>所以，最终的方案是：在 VM Setting 中删除掉 Network Adpater，然后再重启重新添加一个。<br>就这么简单，思路别被局限了。</p>
<!--more-->
<h2 id="机器名"><a href="#机器名" class="headerlink" title="机器名"></a>机器名</h2><p>复制以后的机器，名字都是一样，打算取名为vm-ubuntu1, vm-ubuntu2, vm-ubuntu3… 所以得逐个修改。</p>
<p>首先 <code>hostname vm-ubuntu2</code> 是不能保存的，重启后又还原，所以得修改<code>/etc/hostname</code>，内容就一行，<code>vm-ubuntu2</code></p>
<p>其次，光改了名字，从其他的机器是ping不到的，所以我们需要修改 <code>/etc/hosts</code> 来把所有的机器都列出来。</p>
<p><pre class="lang:default decode:true" title="hosts">127.0.0.1   localhost<br>192.168.48.142  vm-ubuntu1<br>192.168.48.156  vm-ubuntu2<br>192.168.48.148  vm-ubuntu3</pre><br>将 hosts 文件复制到所有的虚拟机（你也可以使用rsync同步），这样就可以通过名字互通了。</p>
<h2 id="静态IP"><a href="#静态IP" class="headerlink" title="静态IP"></a>静态IP</h2><p>上面这样做了之后，会有一个问题，就是DHCP重启之后IP会变，名字就失效了，所以需要改成静态IP。<br>很简单，先 ifconfig 查看一下 当前的 网关和掩码，</p>
<p><pre class="lang:default decode:true">Link encap:Ethernet  HWaddr 00:0c:29:1f:2a:fc<br>          inet addr:192.168.48.142  Bcast:192.168.48.255  Mask:255.255.255.0</pre><br>网关是 <code>192.168.48.255</code>， 掩码是 <code>255.255.255.0</code>，同时可以看到Mac已经变了(HWaddr就是）</p>
<p>然后修改 <code>/etc/network/interfaces</code> 就可以了，</p>
<p><pre class="lang:default decode:true">auto eth0<br>iface eth0 inet dhcp</pre><br>改为</p>
<p><pre class="lang:default decode:true">auto eth0<br>iface eth0 inet static<br>address 192.168.48.100<br>netmask 255.255.255.0<br>gateway 192.168.48.255</pre><br>这儿有个陷阱，就是 VM 的 网关实际上并不是 192.168.xx.255，而是window下看到的 VMware Network Adapter VMnet8 的 IP，一般是 192.168.xx.2，可以尝试 192.168.xx.1 或者 192.168.xx.2，所以真实的应该是</p>
<p><pre class="lang:default decode:true">auto eth0<br>iface eth0 inet static<br>address 192.168.48.101<br>netmask 255.255.255.0<br>gateway 192.168.48.2</pre><br>注意：我们不要使用192.168.xx.1 或者 2 来作为虚机的IP，这些都保留了，安全起见，用100之后的。<br>最后 sudo reboot，重启之后就可以联网了。</p>
<h2 id="DNS-域名解析"><a href="#DNS-域名解析" class="headerlink" title="DNS 域名解析"></a>DNS 域名解析</h2><p>上面设好了后，内网基本没问题，但是连外网可能会碰到问题，域名解析不了（我碰到了），所以需要设置DNS。<br>网上的方法，有一种是修改 <code>/etc/network/interfaces</code> 加上 nameserver</p>
<p><pre class="lang:default decode:true">auto eth0<br>iface eth0 inet static<br>address 192.168.48.101<br>netmask 255.255.255.0<br>gateway 192.168.48.2<br>nameserver 8.8.8.8</pre><br>这个貌似没有用，最后有用的方法是，修改 <code>/etc/resolveconf/resolve.conf.d/base</code>，加上 nameserver 就可以了</p>
<p><pre class="lang:default decode:true">nameserver 192.168.48.2<br>nameserver 8.8.8.8<br>nameserver 8.8.4.4</pre></p>
<ul>
<li>END</li>
</ul>

        
        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Linux/">Linux</a> <a class="tag tag--primary tag--small t-link" href="/tags/Ubuntu/">Ubuntu</a> <a class="tag tag--primary tag--small t-link" href="/tags/VM/">VM</a> <a class="tag tag--primary tag--small t-link" href="/tags/article/">article</a> <a class="tag tag--primary tag--small t-link" href="/tags/configuration/">configuration</a> <a class="tag tag--primary tag--small t-link" href="/tags/network/">network</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/how-to-setup-kafka-web-console/"  data-tooltip="How to Setup Kafka Web Console">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/redefine-industry-by-changing-usage/" data-tooltip="改变使用方式，重定义一个行业">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?appkey=&amp;title=Ubuntu12 虚拟机网络配置&amp;url=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-weibo"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#comments">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
        
            
                
                    <div id="comments">
</div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
	const gitalk = new Gitalk({
		id: 'Ubuntu12 虚拟机网络配置', // optional
		owner: 'samuelchen',
		repo: 'samuelchen.github.io',
		clientID: '82fc507622c63bb0b5c9',
		clientSecret: 'd88a2e4d50c00b59670fcf56bfb3906ab6c996a6',
		admin: ['samuelchen', ],
		labels: ['comment', ],
		distractionFreeMode: false  // Facebook-like distraction free mode
	})
	gitalk.render('comments');
</script>

                
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Samuel Chen. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/how-to-setup-kafka-web-console/"  data-tooltip="How to Setup Kafka Web Console">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/redefine-industry-by-changing-usage/" data-tooltip="改变使用方式，重定义一个行业">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?appkey=&amp;title=Ubuntu12 虚拟机网络配置&amp;url=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-weibo"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#comments">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="1">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?appkey=&amp;title=Ubuntu12 虚拟机网络配置&amp;url=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-weibo"></i><span class="">Share on Weibo</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://blog.samuelchen.net/ubuntu12-vm-network-config/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.gif"/>
        
            <h4 id="about-card-name">Samuel Chen</h4>
        
            <h5 id="about-card-bio"><p>I am living in Wuhan with my wife and daughter.<br>Before 2010, I was living in Beijing for a long time.<br>My interesings are cloud technology, distributed system, data mining and mobile technologies.<br>In my spare time, I like to play football and swiming.<br>“Explorer. Dream. Discover. “ is my favorite quotation. And it is also the way I am looking for and doing.</p>
</h5>
        
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Wuhan, China
            </h5>
        
    </div>
</div>
        <div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js"></script>
<!--SCRIPTS END-->




    <!-- if CDN fails, use local file -->
    <script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
    <script> window.mermaid || document.write('<script src="/assets/js/mermaid.min.js"><\/script>')</script>

    <script>
        $(document).ready(function() {
            var mermaid_config = {
                startOnLoad: true,
                theme: 'neutral',
                flowchart:{
                    useMaxWidth: false,
                    htmlLabels: true
                }                
            }
            mermaid.initialize(mermaid_config);
        });
    </script>


</html>
